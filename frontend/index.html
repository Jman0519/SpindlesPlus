<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spindles Plus Internal Job Board</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        iframe {
            border: none;
            width: 300px;
            height: 400px;
            position: fixed;
            top: 50%;
            left: 50%;
            /* Adjust height as needed */
        }
    </style>
</head>

<body>
    <p>&copy; 2023 Spindles Plus Incorporated |
        <a href="index.html">Job Board</a> |
        <a href="contactUs.html">Contact Us</a> |
        <a href="about.html">About</a> |
        <a href="CreateNewJob.html">Create New Job</a> |
    </p>

    <table id="data-table">
        <thead>
            <tr>
                <th>Customer Name</th>
                <th>Received Date</th>
                <th>Incoming Shipping Container</th>
                <th>Unit</th>
                <th>Tear Down</th>
                <th>Quoted Date</th>
                <th>Approval Date</th>
                <th>Cleaning</th>
                <th>Grind Required</th>
                <th>Grind Type</th>
                <th>Grind Info</th>
                <th>Grind Complete</th>
                <th>Motor Requirement</th>
                <th>Motor Info</th>
                <th>Parts Required</th>
                <th>Parts List</th>
                <th>Build</th>
                <th>Test</th>
                <th>Estimated Ship Date</th>
                <th>Ready To Ship</th>
            </tr>
        </thead>
        <tbody>
            <!-- Add your data rows here -->
            <tr onclick="showIframe('EditJob.html')">
                <!-- Add your data for each column -->
            </tr>
        </tbody>
    </table>

    <iframe id="popup-iframe"></iframe>

    <script>
        function showIframe(url) {
            var iframe = document.getElementById('popup-iframe');
            iframe.src = url;
        }
    </script>

    <script>
        function createTable(jobs) {
            let table = document.getElementById('data-table');
            let headers = ["Customer Name", "Received Date", "Incoming Shipping Container", "Unit", "Tear Down", "Quoted Date", "Approval Date", "Cleaning", "Grind Required", "Grind Type", "Grind Info", "Grind Complete", "Motor Requirement", "Motor Info", "Parts Required", "Parts List", "Build", "Test", "Estimated Ship Date", "Ready To Ship"];
            //create rows
            let rows = [];
            for (let i = 0; i < jobs.length; i++) {
                let row = document.createElement('tr');
                for (let header of headers) {
                    let cell = document.createElement('td');

                    let text = jobs[i][header];

                    if (header == "Received Date" || header == "Quoted Date" || header == "Approval Date" || header == "Estimated Ship Date") {
                        //change from yyyy-mm-dd to mm/dd/yy
                        text = text.split('-');
                        text = text[1] + '/' + text[2] + '/' + text[0].slice(-2);
                    }
                    if (header == "Tear Down" || header == "Cleaning" || header == "Grind Required" || header == "Grind Complete" || header == "Ready To Ship") {
                        //change from true/false to yes/no
                        text = text ? "Yes" : "No";
                    }

                    if (jobs[i][header] === undefined || jobs[i][header] === "") {
                        text = "";
                    }

                    cell.textContent = text;
                    row.appendChild(cell);
                }
                row.onclick = function () {
                    showIframe('EditJob.html'); // Replace with actual URL
                };
                rows.push(row);
            }

            //create headers
            let headerRow = document.createElement('tr');
            for (let headerName of headers) {
                let header = document.createElement('th');
                header.textContent = headerName;
                headerRow.appendChild(header);
            }

            // set the table
            table.innerHTML = '';
            table.appendChild(headerRow);
            for (let i = 0; i < rows.length; i++) {
                table.appendChild(rows[i]);
            }
        }

        async function getData() {
            let jobs = Object.values(await (await fetch("/getJobs")).json());

            // TODO: check if the data is any different
            createTable(jobs);
        }
        setInterval(function () {
            // Call a function repetatively with 2 Second interval
            getData();
        }, 1000); //1000mSeconds update rate
    </script>
    <footer>
        <p>&copy; 2023 Spindles Plus Incorporated | All Rights Reserved | 
            <a href="index.html">Job Board</a> |
            <a href="contactUs.html">Contact Us</a> |
            <a href="about.html">About</a> |
        </p>
    </footer>
</body>

</html>